{% extends "./dashboardBse.html" %}
{% load widget_tweaks %}
{% load static %}
{%block content%}
<div class="row ml-4">
                        <div class="col-4">
                                <div id="members">
                                    <small class="float-left mt-1 ml-1">Moderateurs</small>
                                    <div class="text-dash">
                                {{nbpmod}} <span class="fa fa-users"></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-4">
                                <div id="total-topics">
                                    <small class="float-left mt-1 ml-1">Professors</small>
                                    <div class="text-dash">
                                {{nbprof}} <span class="fa fa-user-tie"></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div id="online">
                                <small class="float-left mt-1 ml-1">Students</small>
                                <div class="text-dash">
                                        {{nbstd}} <span class="fa fa-graduation-cap" style="font-size:31px;"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                <div class="row ml-2">
                    <div class="col-6">
                    

                      <div class="admin-usr-notif  text-center" {% if usersNo.count  == 0  %} style="opacity:0"{% endif %} >
                            <span class="fa fa-exclamation-circle icons admin-notif-spn"></span>
                            You have {{usersNo.count}} users to approve , <a href="#" class="menu-item" data-toggle="modal" data-target="#usersApprove" onclick="getUsersNo()">Click here</a> to view the details.
                        </div>
                  
                    
                        
                        <div class="modal fade" id="usersApprove" tabindex="-1" role="dialog" aria-labelledby="usersApproveLabel" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                  <div class="modal-content">
                                    <div class="modal-header">
                                      <h5 class="modal-title" id="usersApproveLabel">List of users to approve</h5>
                                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                      </button>
                                    </div>
                                    <div class="modal-body">
                                            <table>
                                            
                                                <tr>
                                                    <th>Username</th>
                                                    <th>Email</th>
                                                    <th>Type</th>
                                                    <th>Approve</th>
                                                </tr>
                                                {% for  userr in usersNo %}
                                                  <tr>
                                                    <td>{{userr.user.username}}</td>
                                                    <td>{{userr.user.email}}</td>
                                                    <td>{{userr.user.role}}</td>
                                                    <form method="Post">
                                                      {% csrf_token %}
                                                      <button type="submit" style="opacity:0" id="btntoapprove"  name='approve'>
                                                     <td><a href="#" onclick="btntoaprv(this)"><span class="fa fa-check-circle icons"></span></a></td></button>
                                                      {% render_field  formuserno.username  type="hidden" value="" id="usertoapprove" %}
                                                      
                                                    </form>
                                                </tr>
                                                {% endfor %}
                                                
                                                
                                                
                                            </table>
                                            
                                    </div>
                                    <div class="modal-footer">
                                      <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                                    </div>
                                  </div>
                                </div>
                              </div>
                    </div>
                </div>
                <div class="row ml-4">
                    <div class="col-md-10 mt-4 col-center">
                            <div class="float-right">
                            <button class="btn-new ml-4 " style="width: 100%;" type="button" data-toggle="modal" data-target="#modPop">
                              Add Moderator
                            </button>
                                    <div class="row">
                                        <div class="col">
                                                <div class="col-12 mr-4"  >
                                                            <form method="POST">
                                                              {% csrf_token %}
                                                                {% render_field  formselect.select   class=" btn-new float-right mb-4" onclick="slectfnct()" %}
                                                                <button type="submit"  id="btnSelect" style="opacity:0" name="selectt">
                                                            </form>
                                                </div>
                                        </div>
                                    </div>
                                </div>
                        <div class="box">
                            <p>Users</p>
                            <span class="table-caption">
                                all active users </span>
                        </div>
                        <div class="tab" style="height:400px ">
                         <div style="height:280px;width:700px; overflow-y:scroll;position :relative;top:-20px"  >
                            <table>
                                <tr>
                                    <th></th>
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th>Type</th>
                                    <th><span class="fa fa-comments icons"></th>
                                </tr>
                                
                                {% for userr in users %}
                                  <tr>
                                    <td>
                                        <img src="../images/avatars/1.jpg" class="usr-tab">
                                    </td>
                                    <td>{{userr.user.username}} </td>
                                    <td>{{userr.user.email}}</td>
                                    <td>{{userr.user.role}}</td>
                                    <td>{{userr.user.commentes.count}}</td>
                                    <td><a href="#" role="button" data-toggle="modal" data-target="#editUser" onclick="getdata(this)"><span class="fa fa-pen icons mr-4"></span></a>
                                        <a href="#" role="button" data-toggle="modal" data-target="#banPop"><span class="fa fa-ban icons mr-4"></span></a>
                                        <a href="#" role="button" data-toggle="modal" data-target="#deletePop" onclick="delecticn(this)"><span class="fa fa-trash icons mr-4"></span></a>
                                        </td>
                                </tr>
                                {% endfor %}
                                
                               
                            </table>
                            </div>
                            <form method="post">
                              {% csrf_token %}

                            <div class="modal fade" id="editUser" tabindex="-1" role="dialog" aria-labelledby="editUserLabel" aria-hidden="true">
                                    <div class="modal-dialog modal-lg" role="document">
                                      <div class="modal-content">
                                        <div class="modal-header">
                                          <h5 class="modal-title" id="editUserLabel">Edit User</h5>
                                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                          </button> 
                                        </div>
                                        <form ></form>
                                        <div class="modal-body">
                                                <div class="float-left text-center ml-4">
                                                        <img src="../images/avatars/1.jpg" class="avatar-setting">
                                                        <br>
                                                        
                                                            <br>
                                                            <label class="field a-field a-field_a1 page__field float-left">
                                                                     {% render_field  formusers.email  class="field__input a-field__input"  placeholder="example@esi-sba.dz" value="" id="email" %}
                                                                    
                                                                    <span class="a-field__label-wrap">
                                                                        <span class="a-field__label">Email</span>
                                                                        <span class="fa fa-envelope float-right mt-2 mr-3 icons"></span>
                                                                    </span>
                                                            </label>
                                                </div>
                                                <div class="float-right mr-4 text-center">
                                                <label class="field a-field a-field_a1 page__field float-right">
                                                        {% render_field  formusers.username  class="field__input a-field__input" placeholder="bondbenz"  id="username" %}
                                                        <span class="a-field__label-wrap">
                                                            <span class="a-field__label" >Username</span>
                                                            <span class="fa fa-user float-right mt-2 mr-3 icons"></span>
                                                        </span>
                                                </label><br>
                                                <label class="field a-field a-field_a1 page__field float-right">
                                                        {% render_field  formusers.password  class="field__input a-field__input" type="password" placeholder="********" value=""  %}
                                                        <span class="a-field__label-wrap">
                                                            <span class="a-field__label" >New Password</span>
                                                            <span class="fa fa-lock float-right mt-2 mr-3 icons"></span>
                                                        </span>
                                                </label><br><br><br>
                                                <label class="field a-field a-field_a1 page__field float-right">
                                                {% render_field  formusers.password1  class="field__input a-field__input" type="password" placeholder="********" value=""  %}
                                                        <span class="a-field__label-wrap">
                                                            <span class="a-field__label" >Confirm Password</span>
                                                        </span>
                                                </label><br>
                                                  {% render_field  formusers.username1  type="hidden" id="custId" name="custId" value=""  %}
                                                

                                                <span>
                                                        Usergroup : 
                                                        {% render_field  formusers.role  class="selectpicker" %}
                                                        
                                                </span>
                                                </div>
                                        </div>

                                        <div class="modal-footer">
                                          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                          <button type="submit" class="btn btn-danger" name='update'>Save</button>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                  </form>
                                  <div class="modal fade" id="deletePop" tabindex="-1" role="dialog" aria-labelledby="deletePopLabel" aria-hidden="true">
                                        <div class="modal-dialog" role="document">
                                          <div class="modal-content">
                                            <div class="modal-header">
                                              <h5 class="modal-title" id="deletePopLabel">Alert</h5>
                                              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                              </button>
                                            </div>
                                            <div class="modal-body text-danger">
                                              Are you sure you want to delete this user?
                                            </div>
                                            <div class="modal-footer">
                                              <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
                                              <form method="POST">
                                                {% csrf_token %}
                                                <button type="submit" class="btn btn-danger" name="delete">Delete</button>
                                                {% render_field  formdelete.username  type="hidden" value="" id="deletinpt" %}
                                              </form>
                                            </div>
                                          </div>
                                        </div>
                                      </div>
                                      <div class="modal fade" id="banPop" tabindex="-1" role="dialog" aria-labelledby="banPopLabel" aria-hidden="true">
                                            <div class="modal-dialog" role="document">
                                              <div class="modal-content">
                                                <div class="modal-header">
                                                  <h5 class="modal-title" id="banPopLabel">Alert</h5>
                                                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                  </button>
                                                </div>
                                                <div class="modal-body text-danger">
                                                  Are you sure you want to ban this user?
                                                </div>
                                                <div class="modal-footer">
                                                  <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
                                                  <button type="button" class="btn btn-danger">Ban</button>
                                                </div>
                                              </div>
                                            </div>
                                          </div>
                        </div>
                    </div>
                </div>
                <div class="modal fade" id="modPop" tabindex="-1" role="dialog" aria-labelledby="modPopLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg" role="document">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="editUserLabel">Add Moderator</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                              <span aria-hidden="true">&times;</span>
                            </button>
                          </div>
                          <div class="modal-body">
                            
                                  <div class="float-left text-center ml-4">
                                          <img src="../images/avatars/1.jpg" class="avatar-setting">
                                          <br>
                                          <form class="mt-2">
                                                  <div class="custom-file" id="customFile">
                                                      <input type="file" class="custom-file-input" id="exampleInputFile" aria-describedby="fileHelp">
                                                      <label class="custom-file-label" for="exampleInputFile">
                                                          Upload avatar
                                                      </label>
                                                  </div>
                                              </form>
                                              <br>
                                              <form method="POST">
                                              {% csrf_token %}
                                              <label class="field a-field a-field_a1 page__field float-left">
                                                    {% render_field  formadd.email  class="field__input a-field__input"  placeholder="example@esi-sba.dz" value="" %}                                                     
                                                      <span class="a-field__label-wrap">
                                                          <span class="a-field__label">Email</span>
                                                          <span class="fa fa-envelope float-right mt-2 mr-3 icons"></span>
                                                      </span>
                                              </label>
                                  </div>
                                  <div class="float-right mr-4 text-center">
                                  <label class="field a-field a-field_a1 page__field float-right">
                                          {% render_field  formadd.username  class="field__input a-field__input" placeholder="bondbenz" value="" %}
                                          <span class="a-field__label-wrap">
                                              <span class="a-field__label">Username</span>
                                              <span class="fa fa-user float-right mt-2 mr-3 icons"></span>
                                          </span>
                                  </label><br>
                                  <label class="field a-field a-field_a1 page__field float-right">
                                          {% render_field  formadd.password  class="field__input a-field__input" type="password" placeholder="********" value="" %}                                         
                                          <span class="a-field__label-wrap">
                                              <span class="a-field__label">New Password</span>
                                              <span class="fa fa-lock float-right mt-2 mr-3 icons"></span>
                                          </span>
                                  </label><br>
                                  <label class="field a-field a-field_a1 page__field float-right">
                                          {% render_field  formadd.password  class="field__input a-field__input" type="password" placeholder="********" value="" %}
                                          
                                          <span class="a-field__label-wrap">
                                              <span class="a-field__label">Confirm Password</span>
                                          </span>
                                  </label><br>
                                  </div>
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-danger" name="addmod">Add</button>
                          </div>
                        </form>
                        </div>
                      </div>
                  </div>
                  <br/><br/><br/>
                  
                <script>
                  function getdata(e){
                     parent=e.parentNode.parentNode;
                     document.getElementById("username").placeholder = parent.childNodes[3].textContent
                     document.getElementById("email").placeholder = parent.childNodes[5].textContent 
                     document.getElementById("custId").value = parent.childNodes[3].textContent
                  }

                  function btntoaprv(e){
                    parent=e.parentNode.parentNode;
                    document.getElementById('usertoapprove').value=parent.childNodes[1].textContent
                    document.getElementById("btntoapprove").click()
                  }
                  function slectfnct(){
                    console.log("ok")
                    document.getElementById("btnSelect").click()
                  } 

                  function delecticn(e){
                      parent =e.parentNode.parentNode;
                       document.getElementById("deletinpt").value=parent.childNodes[3].textContent
                  }

                  

                  
                </script>
                
{% endblock content %}              